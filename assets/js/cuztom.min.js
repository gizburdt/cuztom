jQuery.noConflict();jQuery(function(e){var t;(t=function(t){t=e(t);e(".js-cuztom-datepicker",t).map(function(){return e(this).datepicker({dateFormat:e(this).data("date-format")})});e(".js-cuztom-timepicker",t).map(function(){return e(this).timepicker({timeFormat:e(this).data("time-format")})});e(".js-cuztom-datetimepicker",t).map(function(){return e(this).datetimepicker({timeFormat:e(this).data("time-format"),dateFormat:e(this).data("date-format")})});e(".js-cuztom-colorpicker",t).wpColorPicker();e(".js-cuztom-tabs",t).tabs();e(".js-slider",t).slider();e(".js-cuztom-accordion",t).accordion();e(".js-cuztom-sortable",t).sortable({handle:".cuztom-handle-sortable a"})})("body");e("body").on("click",".js-cuztom-upload",function(){var t=e(this),n=t.closest(".js-cuztom-field-selector"),r=n.attr("id"),i=window["Cuztom_"+r],s=i.type,o=e(".cuztom-hidden",n),u=e(".cuztom-preview",n),a;console.log(i);try{preview_size=e.parseJSON(i.args.preview_size)}catch(f){preview_size=t.data("cuztom-media-preview-size")}if(a){a.open();return}a=wp.media.frames.file_frame=wp.media({multiple:!1});a.on("select",function(){attachment=a.state().get("selection").first().toJSON();e(".js-cuztom-remove-media",parent).remove();t.after('<a href="#" class="js-cuztom-remove-media cuztom-remove-media">'+(s=="image"?Cuztom.remove_image:Cuztom.remove_file)+"</a> ");if(s=="image"){console.log(attachment);var n=preview_size&&!e.isArray(preview_size)&&attachment.sizes[preview_size]?attachment.sizes[preview_size]:attachment.sizes.medium?attachment.sizes.medium:attachment.sizes.full;if(e.isArray(preview_size)){parseInt(preview_size[0])>0&&(n.width=parseInt(preview_size[0]));parseInt(preview_size[1])>0&&(n.height=parseInt(preview_size[1]))}u.html('<img src="'+n.url+'" height="'+n.height+'" width="'+n.width+'" />');o.val(attachment.id)}else{u.html('<span class="cuztom-mime"><a href="'+attachment.url+'" target="_blank">'+attachment.name+"</a></span>");o.val(attachment.url)}});a.open();return!1});e("body").on("click",".js-cuztom-remove-media",function(){var t=e(this),n=t.closest(".cuztom-td, .form-field");e(".cuztom-preview",n).html("");e(".cuztom-hidden",n).val("");t.hide();return!1});e("body").on("click",".js-cuztom-remove-sortable",function(){var t=e(this),n=t.closest(".js-cuztom-sortable-item"),r=t.closest(".js-cuztom-sortable"),i=r.find(".js-cuztom-sortable-item").length;i>1&&n.remove();i==2&&r.find(".js-cuztom-sortable-item").find(".js-cuztom-remove-sortable").remove();return!1});e("body").on("click",".js-cuztom-add-sortable",function(){var n=e(this),r=n.closest(".js-cuztom-field-selector"),i=r.attr("id"),s=window["Cuztom_"+i],o=e(".js-cuztom-sortable",r),u=s.type=="bundle",a='<div class="cuztom-handle-sortable js-cuztom-handle-sortable"></div>',f='<div class="cuztom-remove-sortable js-cuztom-remove-sortable"></div>',l=e(".js-cuztom-sortable-item:last",o),c=l.clone(!1,!1),h=e(".js-cuztom-sortable-item",o).length,p=[];if(h>=s.limit){alert("Limit reached!");return!1}u&&c.find(".cuztom-tr").each(function(){var t=e(this),n=t.find(".js-cuztom-field-selector"),r=e(".cuztom-input",n),i=n.attr("id"),s=window["Cuztom_"+i];(s.type=="checkbox"||s.type=="radio")&&r.each(function(){e(this).removeAttr("checked").prop("checked",!1);var t=e(this).closest(".cuztom-checkboxes-wrap").data("default-value");t!=undefined&&(t+"").length&&t==e(this).val()&&e(this).attr("checked","checked").prop("checked",!0)});if(s.type=="wysiwyg"){var o=r.attr("id"),u=r.attr("name");e(this).find("span.mceEditor").remove();r.show()}r.attr("name",function(e,t){return t.replace(/\[(\d+)\]/,function(e,t){return"["+(Number(t)+1)+"]"})}).attr("id",function(e,t){return t.replace(/\_(\d+)/,function(e,t){return"_"+(Number(t)+1)})}).removeClass("hasDatepicker");e(this).find("label").attr("for",r.attr("id"));if(s.type=="color"){r.attr("value","");e(this).find(".cuztom-td").html(r.clone(!1))}r.hasClass("cuztom-select")&&r.each(function(){var t=e(this).data("default-value");e(this).find("option").removeAttr("selected").prop("selected",!1);t!=undefined&&(t+"").length&&e(this).find("option").each(function(){e(this).val()==t&&e(this).attr("selected","selected").prop("selected",!0)})});if(s.type=="wysiwyg"){var a=r.attr("id"),f=r.attr("name"),l=new RegExp(o,"g"),c=new RegExp(u,"g");e(this).html(e(this).html().replace(c,f).replace(l,a));tinyMCEPreInit.mceInit[a]=tinyMCEPreInit.mceInit[o];tinyMCEPreInit.mceInit[a].body_class=tinyMCEPreInit.mceInit[a].body_class.replace(l,a);tinyMCEPreInit.mceInit[a].elements=tinyMCEPreInit.mceInit[a].elements.replace(l,a);QTags.instances[a]=QTags.instances[o];QTags.instances[a].canvas=r[0];QTags.instances[a].id=a;QTags.instances[a].settings.id=a;QTags.instances[a].name="qt_"+a;QTags.instances[a].toolbar=e(this).find(".quicktags-toolbar")[0];var h="html";e(this).find(".wp-editor-wrap").hasClass("tmce-active")&&(h="tmce");p.push({id:a,mode:h})}});c.find(".cuztom-input, select, textarea").val("").removeAttr("selected");c.find(".js-cuztom-remove-media").remove();c.find(".cuztom-preview").html("");c.appendTo(o);t(c);e(".js-cuztom-sortable-item",parent).each(function(t,n){e(".js-cuztom-handle-sortable",n).length==0&&e(n).prepend(a);e(".js-cuztom-remove-sortable",n).length==0&&e(n).append(f)});for(var d=0;d<p.length;d++)p.go(p[d].id,p[d].mode);return!1});e(".cuztom-td").on("click",".js-cuztom-ajax-save",function(){var t=e(this),n=t.closest(".cuztom-td"),r=n.closest(".cuztom"),i=e(".cuztom-input",n),s=i.attr("id"),o=i.val(),u=r.data("meta-type"),a=r.data("object-id"),f={action:"cuztom_field_ajax_save",cuztom:{value:o,field_id:s,meta_type:u,object_id:a}};e.post(Cuztom.ajax_url,f,function(e){var t=i.css("border-color");i.animate({borderColor:"#60b334"},200,function(){i.animate({borderColor:t})})});return!1})});